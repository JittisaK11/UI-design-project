{% extends 'layout.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elements of Rhythm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            padding: 20px;
        }
        .row {
            display: flex;  /* Utilizing Flexbox */
            justify-content: space-around;  /* Even spacing */
            align-items: center;  /* Align vertically */
        }
        .drop-container {
            flex: 1;  /* Each container will flexibly take up equal space */
            margin: 10px;  /* Margin for spacing between containers */
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        .next-button {
            text-align: center;
            margin-top: 20px;
        }
        .next-button a {
            padding: 10px 20px;
            background-color: #8eadd4;
            color: white;
            text-decoration: none;
        }
        .next-button a:hover {
            background-color: #ddd;
            color: black;
        }
    </style>
</head>
<body>

    <!-- Container for quiz content -->
    <div class="container">
        <!-- Display the current score of the user -->
        <p>Current Score: <span id="current-score"></span></p>

        <!-- Quiz question and content -->
            <p>Question 1) Match these songs to the tempo terms by clicking on the buttons below the videos.</p>
            <div class="row">
                <div style="display: flex; justify-content: space-around;">
                    <div>
                        <button class="match-button" id="button-adagio">Adagio</button>
                        <iframe class="video" width="400" height="300" src="https://www.youtube.com/embed/02AlIVN0pEA"></iframe>
                        <button class="video-button" id="video-button-1" disabled>Video 1</button>
                    </div>

                    <div>
                        <button class="match-button" id="button-andante">Andante</button>
                        <iframe class="video" width="400" height="300" src="https://www.youtube.com/embed/VOLy6JxEDLw"></iframe>
                        <button class="video-button" id="video-button-2" disabled>Video 2</button>
                    </div>

                    <div>
                        <button class="match-button" id="button-allegro">Allegro</button>
                        <iframe class="video" width="400" height="300" src="https://www.youtube.com/embed/zplA4AnhCk8"></iframe>
                        <button class="video-button" id="video-button-3" disabled>Video 3</button>
                    </div>
                    </div>
            </div>
            <!-- Next button -->
            <div class="next-button">
                <a href="quiz2" id="next-button">Next</a>
            </div>
                <!-- JavaScript code -->
                <script>
                    document.addEventListener("DOMContentLoaded", function() {
            function fetchAndUpdateScore() {
                fetch('/score')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch score');
                    }
                    return response.json();
                })
                .then(data => {
                    const currentScore = document.getElementById("current-score");
                    currentScore.textContent = data.score; // Update the score element
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        function incrementScore() {
            fetch('/increment-score', {
                method: 'POST'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to increment score');
                }
                return response.json();
            })
            .then(data => {
                // If increment successful, fetch and update the score
                fetchAndUpdateScore();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

            // Call the function to fetch and update the score when the page loads
            fetchAndUpdateScore();

                        const adagioButton = document.getElementById("button-adagio");
                        const andanteButton = document.getElementById("button-andante");
                        const allegroButton = document.getElementById("button-allegro");
                        const videoButtons = document.querySelectorAll(".video-button");
                        videoButtons.forEach(function(button) {
                            button.disabled = false;
                            button.ruledOut = false;
                        });
                        const userScore = document.getElementById("user-score");
                        const nextButton = document.getElementById("next-button");

                        let score = 0;
                        let currentRhythm = 0;

                        adagioButton.addEventListener("click", function() {
                            adagioButton.style.backgroundColor = "red";
                            andanteButton.style.backgroundColor = ""; // Make other buttons neutral
                            allegroButton.style.backgroundColor = ""; // Make other buttons neutral

                            videoButtons.forEach(function(button) {
                                if (button.ruledOut == false) {
                                    button.disabled = false;
                                }
                            });
                            currentRhythm = 1;
                        });

                        andanteButton.addEventListener("click", function() {
                            andanteButton.style.backgroundColor = "red";
                            adagioButton.style.backgroundColor = ""; // Make other buttons neutral
                            allegroButton.style.backgroundColor = ""; // Make other buttons neutral

                            videoButtons.forEach(function(button) {
                                if (button.ruledOut == false) {
                                    button.disabled = false;
                                }
                            });
                            currentRhythm = 2;
                        });

                        allegroButton.addEventListener("click", function() {
                            allegroButton.style.backgroundColor = "red";
                            adagioButton.style.backgroundColor = ""; // Make other buttons neutral
                            andanteButton.style.backgroundColor = ""; // Make other buttons neutral

                            videoButtons.forEach(function(button) {
                                if (button.ruledOut == false) {
                                    button.disabled = false;
                                }
                            });
                            currentRhythm = 3;
                        });

                        videoButtons.forEach(function(button) {
                            button.addEventListener("click", function() {
                                const videoId = button.id.split("-")[2];
                                if (currentRhythm == videoId) {
                                    button.style.backgroundColor = "green";
                                    adagioButton.style.backgroundColor = (videoId === "1") ? "green" : adagioButton.style.backgroundColor;
                                    andanteButton.style.backgroundColor = (videoId === "2") ? "green" : andanteButton.style.backgroundColor;
                                    allegroButton.style.backgroundColor = (videoId === "3") ? "green" : allegroButton.style.backgroundColor;
                                    adagioButton.disabled = (videoId === "1") ? true : adagioButton.disabled;
                                    andanteButton.disabled = (videoId === "2") ? true : andanteButton.disabled;
                                    allegroButton.disabled = (videoId === "3") ? true : allegroButton.disabled;
                                    adagioButton.ruledOut = (videoId === "1") ? true : adagioButton.ruledOut;
                                    andanteButton.ruledOut = (videoId === "2") ? true : andanteButton.ruledOut;
                                    allegroButton.ruledOut = (videoId === "3") ? true : allegroButton.ruledOut;
                                    videoButtons.forEach(function(button) {
                                        button.disabled = true;
                                    });
                                    incrementScore();
                                    fetchAndUpdateScore();
                                    button.ruledOut = true; // Add the ruledOut property
                                }
                            });
                        });
                        });
                </script>
</body>
</html>

{% endblock %}
