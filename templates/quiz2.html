
{% extends 'layout.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elements of Rhythm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .navbar {
            overflow: hidden;
            background-color: #8eadd4;
        }
        .navbar a {
            float: left;
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }
        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }
        .container {
            padding: 20px;
        }
        .row {
            display: flex;  /* Utilizing Flexbox */
            justify-content: space-around;  /* Even spacing */
            align-items: center;  /* Align vertically */
        }
        .drop-container {
            flex: 1;  /* Each container will flexibly take up equal space */
            margin: 10px;  /* Margin for spacing between containers */
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }
        .next-button {
            text-align: center;
            margin-top: 20px;
        }
        .next-button a {
            padding: 10px 20px;
            background-color: #8eadd4;
            color: white;
            text-decoration: none;
        }
        .next-button a:hover {
            background-color: #ddd;
            color: black;
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Display the current score of the user -->
        <p>Current Score: <span id="current-score"></span></p>
                
        <p>Question 2) Which of these songs feature an upbeat tempo vs. downbeat tempo?
        </p>
        <div class="row">
            <button id="drop-container-upbeat">Upbeat</button>
            <button id="drop-container-downbeat">Downbeat</button>
        </div>
        <div class="row">
            <iframe class="drop-container" width="420" height="315" src="https://www.youtube.com/embed/02AlIVN0pEA"></iframe>
            <iframe class="drop-container" width="420" height="315" src="https://www.youtube.com/embed/p_ftrysaMHU"></iframe>
        </div>
        <div class="row">
            <button class="video-button" id="video-button-1" disabled>Video 1</button>
            <button class="video-button" id="video-button-2" disabled>Video 2</button>
        </div>

    </div>
    <div class="next-button">
        <a href="quiz3">Next</a>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            function fetchAndUpdateScore() {
                fetch('/score')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to fetch score');
                        }
                        return response.json();
                    })
                    .then(data => {
                        const currentScore = document.getElementById("current-score");
                        currentScore.textContent = data.score; // Update the score element
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
    
            function incrementScore() {
                fetch('/increment-score', {
                        method: 'POST'
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to increment score');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // If increment successful, fetch and update the score
                        fetchAndUpdateScore();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
    
            // Call the function to fetch and update the score when the page loads
            fetchAndUpdateScore();
    
            const upbeatButton = document.getElementById("drop-container-upbeat");
            const downbeatButton = document.getElementById("drop-container-downbeat");
            const videoButtons = document.querySelectorAll(".video-button");
            videoButtons.forEach(function(button) {
                button.disabled = false;
                button.ruledOut = false;
            });
    
            upbeatButton.addEventListener("click", function() {
                upbeatButton.style.backgroundColor = "red";
                downbeatButton.style.backgroundColor = ""; // Make other buttons neutral
                videoButtons.forEach(function(button) {
                    if (button.ruledOut == false) {
                        button.disabled = false;
                    }
                });
                currentRhythm = 2; // Button 2 corresponds to upbeat
            });
    
            downbeatButton.addEventListener("click", function() {
                downbeatButton.style.backgroundColor = "red";
                upbeatButton.style.backgroundColor = ""; // Make other buttons neutral
                videoButtons.forEach(function(button) {
                    if (button.ruledOut == false) {
                        button.disabled = false;
                    }
                });
                currentRhythm = 1; // Button 1 corresponds to downbeat
            });
    
            videoButtons.forEach(function(button) {
                button.addEventListener("click", function() {
                    const videoId = button.id.split("-")[2];
                    if (currentRhythm == videoId) {
                        button.style.backgroundColor = "green";
                        downbeatButton.style.backgroundColor = (videoId === "1") ? "green" : downbeatButton.style.backgroundColor;
                        upbeatButton.style.backgroundColor = (videoId === "2") ? "green" : upbeatButton.style.backgroundColor;
                        downbeatButton.disabled = (videoId === "1") ? true : downbeatButton.disabled;
                        upbeatButton.disabled = (videoId === "2") ? true : upbeatButton.disabled;
                        downbeatButton.ruledOut = (videoId === "1") ? true : downbeatButton.ruledOut;
                        upbeatButton.ruledOut = (videoId === "2") ? true : downbeatButton.ruledOut;
                        videoButtons.forEach(function(button) {
                            button.disabled = true;
                        });
                        incrementScore();
                        fetchAndUpdateScore();
                        button.ruledOut = true; // Add the ruledOut property
                    }
                });
            });
        });
    </script>
    
</body>
</html>

{% endblock %}

