{% extends "layout.html" %}

{% block content %}

<div class="container">
    <h1>Congrats! You got this score: </h1>
    <div id="current-score" style="font-size: 24px;">[SCORE]</div>

    <h2>Previous Scores:</h2>
    <table id="score-table">
        <tbody>
            <!-- Previous scores will be dynamically added here -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Fetch and display the current score
        fetch('/score')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch score');
                }
                return response.json();
            })
            .then(data => {
                const currentScore = document.getElementById("current-score");
                currentScore.textContent = data.score;
            })
            .catch(error => {
                console.error('Error:', error);
            });

        // Trigger the update scores endpoint to submit the current score
        fetch('/update-scores', {
            method: 'POST'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to update scores');
            }
            return response.json();
        })
        .catch(error => {
            console.error('Error:', error);
        });

        // Fetch and display previous scores
        fetch('/previous-scores')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch previous scores');
                }
                return response.json();
            })
            .then(scores => {
                const scoreTableBody = document.querySelector("#score-table tbody");
                scores.forEach(score => {
                    const row = document.createElement("tr");
                    row.innerHTML = `<td>${score.score}</td>`;
                    scoreTableBody.prepend(row);
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>

{% endblock %}
